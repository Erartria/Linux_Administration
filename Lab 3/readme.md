Лабораторная работа № 3. Управление пользователями, группами пользователей и правами на файлы и каталоги в Linux
===
**Задачи:**
---
  1. Научиться создавать, изменять и редактировать учетные записи пользователей и групп пользователей в Linux.
  2. научиться задавать атрибуты прав и владения для файлов и каталогов под конкретные задачи


**Подсказки:**
---
  1. В работе используются следующие команды (в дополнение к изученным в предыдущих лабораторных работах): groupadd, useradd, groupdel, userdel, groupmod, usermod, openssl, chage, chmod, chgrp, chown, groups, id.
  2. Сведения о пользователях системы и их идентификаторах (UID) хранятся в файле /etc/passwd
  3. Для вывода результата работы команды или конвейера команд в новый файл используется конструкция: command > file
  4. Для добавления результатов работы команды или конвейера команд в конец существующего файла используется конструкция: command >> file
  5. Директория /etc/skel содержит копии различных установочных и других файлов, которые могут быть скопированы в новые домашние директории пользователей, когда программа useradd добавляет нового пользователя.
  6. Для шифрования пароля можно использовать команду openssl passwd –crypt незашифрованный_пароль. Для того чтобы результат выполнения команды command2 подставить в значение параметра p команды command1 можно использовать конструкцию: command1 –p $(command2)
  7. Для получения подробного справочного руководства по любой команде можно набрать в консоли «man название команды».
  8. Для удобства работы можно пользоваться одновременно несколькими консолями. На одной консоли читать справочное руководство, на другой редактировать скрипт и т.п. Переключаться между ними можно нажатием комбинации клавиш Ctrl+Alt+Fn, где Fn – функциональная клавиша (F1 – для первой консоли, F2 – для второй, а вот 7-я консоль обычно занята графическим интерфейсом). 

**Задание:**
---
*Создать скрипт, который:*
  1. выводит в файл work3.log построчно список всех пользователей в системе в следующем формате: «user NNN has id MM»;
  2. добавляет в файл work3.log строку, содержащую дату последней смены пароля для пользователя root;
  3. добавляет в файл work3.log список всех групп в системе (только названия групп) через запятую;
  4. делает так, чтобы при создании нового пользователя у него в домашнем каталоге создавался файл readme.txt с текстом «Be careful!»;
  5. создает пользователя u1 с паролем 12345678;
  6. создает группу g1;
  7. делает так, чтобы пользователь u1 дополнительно входил в группу g1;
  8. добавляет в файл work3.log строку, содержащую сведения об идентификаторе и имени пользователя u1 и идентификаторах и именах всех групп, в которые он входит;
  9. делает так, чтобы пользователь user дополнительно входил в группу g1
  10. добавляет в файл work3.log строку с перечнем пользователей в группе g1 через запятую;
  11. делает так, что при входе пользователя u1 в систему вместо оболочки bash автоматически запускается /usr/bin/mc, при выходе из которого пользователь возвращается к вводу логина и пароля;
  12. создает пользователя u2 с паролем 87654321;
  13. в каталоге /home создает каталог test13, в который копирует файл work3.log два раза с разными именами (work3-1.log и work3-2.log);
  14. сделает так, чтобы пользователи u1 и u2 смогли бы просматривать каталог test13 и читать эти файлы, только пользователь u1 смог бы изменять и удалять их, а все остальные пользователи системы не могли просматривать содержимое каталога test13 и файлов в нем. При этом никто не должен иметь права исполнять эти файлы;
  15. создает в каталоге /home каталог test14, в который любой пользователь системы сможет записать данные, но удалить любой файл сможет только пользователь, который его создал или пользователь u1;
  16. копирует в каталог test14 исполняемый файл редактора nano и делает так, чтобы любой пользователь смог изменять с его помощью файлы, созданные в пункте 13;
  17. создает каталог test15 и создает в нем текстовый файл /test15/secret_file. Делает так, чтобы содержимое этого файла можно было вывести на экран, используя полный путь, но чтобы узнать имя этого файла, было бы невозможно.
*Отдельно создать второй скрипт, который полностью уничтожает результаты деятельности предыдущего: удаляет созданных пользователей и их домашние каталоги, удаляет созданные группы, удаляет все созданные в предыдущем скрипте файлы и каталоги.*

Лабораторная работа № 3. Управление пользователями, группами пользователей и правами на файлы и каталоги в Linux
===
**Задачи:**
---
  1. Научиться создавать, изменять и редактировать учетные записи пользователей и групп пользователей в Linux.
  2. научиться задавать атрибуты прав и владения для файлов и каталогов под конкретные задачи


**Подсказки:**
---
  1. В работе используются следующие команды (в дополнение к изученным в предыдущих лабораторных работах): groupadd, useradd, groupdel, userdel, groupmod, usermod, openssl, chage, chmod, chgrp, chown, groups, id.
  2. Сведения о пользователях системы и их идентификаторах (UID) хранятся в файле /etc/passwd
  3. Для вывода результата работы команды или конвейера команд в новый файл используется конструкция: command > file
  4. Для добавления результатов работы команды или конвейера команд в конец существующего файла используется конструкция: command >> file
  5. Директория /etc/skel содержит копии различных установочных и других файлов, которые могут быть скопированы в новые домашние директории пользователей, когда программа useradd добавляет нового пользователя.
  6. Для шифрования пароля можно использовать команду openssl passwd –crypt незашифрованный_пароль. Для того чтобы результат выполнения команды command2 подставить в значение параметра p команды command1 можно использовать конструкцию: command1 –p $(command2)
  7. Для получения подробного справочного руководства по любой команде можно набрать в консоли «man название команды».
  8. Для удобства работы можно пользоваться одновременно несколькими консолями. На одной консоли читать справочное руководство, на другой редактировать скрипт и т.п. Переключаться между ними можно нажатием комбинации клавиш Ctrl+Alt+Fn, где Fn – функциональная клавиша (F1 – для первой консоли, F2 – для второй, а вот 7-я консоль обычно занята графическим интерфейсом). 

**Задание:**
---
*Создать скрипт, который:*
  1. выводит в файл work3.log построчно список всех пользователей в системе в следующем формате: «user NNN has id MM»;
  2. добавляет в файл work3.log строку, содержащую дату последней смены пароля для пользователя root;
  3. добавляет в файл work3.log список всех групп в системе (только названия групп) через запятую;
  4. делает так, чтобы при создании нового пользователя у него в домашнем каталоге создавался файл readme.txt с текстом «Be careful!»;
  5. создает пользователя u1 с паролем 12345678;
  6. создает группу g1;
  7. делает так, чтобы пользователь u1 дополнительно входил в группу g1;
  8. добавляет в файл work3.log строку, содержащую сведения об идентификаторе и имени пользователя u1 и идентификаторах и именах всех групп, в которые он входит;
  9. делает так, чтобы пользователь user дополнительно входил в группу g1
  10. добавляет в файл work3.log строку с перечнем пользователей в группе g1 через запятую;
  11. делает так, что при входе пользователя u1 в систему вместо оболочки bash автоматически запускается /usr/bin/mc, при выходе из которого пользователь возвращается к вводу логина и пароля;
  12. создает пользователя u2 с паролем 87654321;
  13. в каталоге /home создает каталог test13, в который копирует файл work3.log два раза с разными именами (work3-1.log и work3-2.log);
  14. сделает так, чтобы пользователи u1 и u2 смогли бы просматривать каталог test13 и читать эти файлы, только пользователь u1 смог бы изменять и удалять их, а все остальные пользователи системы не могли просматривать содержимое каталога test13 и файлов в нем. При этом никто не должен иметь права исполнять эти файлы;
  15. создает в каталоге /home каталог test14, в который любой пользователь системы сможет записать данные, но удалить любой файл сможет только пользователь, который его создал или пользователь u1;
  16. копирует в каталог test14 исполняемый файл редактора nano и делает так, чтобы любой пользователь смог изменять с его помощью файлы, созданные в пункте 13;
  17. создает каталог test15 и создает в нем текстовый файл /test15/secret_file. Делает так, чтобы содержимое этого файла можно было вывести на экран, используя полный путь, но чтобы узнать имя этого файла, было бы невозможно.
*Отдельно создать второй скрипт, который полностью уничтожает результаты деятельности предыдущего: удаляет созданных пользователей и их домашние каталоги, удаляет созданные группы, удаляет все созданные в предыдущем скрипте файлы и каталоги.*
**Назначение команд:**
---
* **`groupadd`** - утилита для создания групп пользователей. Группы может создавать только суперпользователь

  **`$ groupadd опции имя_группы`**
  
   **Основные опции:**
   
   * **`-f`** - если группа уже существует, то утилита возвращает положительный результат операции;
   * **`-g`** - установить значение идентификатора группы GID вручную;
   * **`-K`** - изменить параметры по умолчанию автоматической генерации GID;
   * **`-o`** - разрешить добавление группы с неуникальным GID;
   * **`-p`** - задаёт пароль для группы;
   * **`-r`** - указывает, что группа системная;
   * **`-R`** - позволяет изменить корневой каталог.
   * **`sudo usermod -aG group7 имя_пользователя`** - позволяет добавить пользователя в группу на всегда
   
> Группа добаляется в каталог /etc/group
---
* **`useradd`** - утилита для создания пользователя.

  **`$ useradd опции имя_пользователя`**
  
   **Основные опции:**
   
   * **`-f`** - если группа уже существует, то утилита возвращает положительный результат операции
   * **`b`** - базовый каталог для размещения домашнего каталога пользователя, по умолчанию /home;
   * **`-c`** - комментарий к учетной записи;
   * **`-d`** - домашний каталог, в котором будут размещаться файлы пользователя;
   * **`-e`** - дата, когда учетная запись пользователя будет заблокирована, в формате ГГГГ-ММ-ДД;
   * **`-f`** - заблокировать учетную запись сразу после создания;
   * **`-g`** - основная группа пользователя;
   * **`-G`** - список дополнительных групп;
   * **`-k`** - каталог с шаблонами конфигурационных файлов;
   * **`-l`** - не сохранять информацию о входах пользователя в lastlog и faillog;
   * **`-m`** - создавать домашний каталог пользователя, если он не существует;
   * **`-M`** - не создавать домашнюю папку;
   * **`-N`** - не создавать группу с именем пользователя;
   * **`-o`** - разрешить создание пользователя linux с неуникальным идентификатором UID;
   * **`-p`** - задать пароль пользователя;
   * **`-r`** - создать системного пользователя, не имеет оболочки входа, без домашней директории и с идентификатором до SYS_UID_MAX;
   * **`-s`** - командная оболочка для пользователя;
   * **`-u`** - идентификатор для пользователя;
   * **`-D`** - отобразить параметры, которые используются по умолчанию для создания пользователя. Если вместе с этой опцией задать еще какой-либо параметр, то его значение по умолчанию будет переопределено.
> Информация о пользователе хранится в /etc/shadow
---
* **`groupdel`** - утилита для удаления групп пользователей. Группы может удалять только суперпользователь

  **`sudo groupdel group_name`**
> Помните: файлы, принадлежащие удаленной группе, не изменят владельца группы \
Как только мы удалим группу, файл показывает идентификатор группы вместо имени группы
---
* **`groupmod`** - утилита для модификации групп пользователей. Группы может удалять только суперпользователь

  **`groupmod [опции] имя-группы`**
  
  **Основные опции:**
  
  * **`-g`** - изменение индетификатора группы;
  * **`-n`** - изменение имени группы;
  * **`-o`** - позволяет использовать неуникальный GID;
  * **`-p`** - установка пароля, пароль должен пройти шифрацию;
  * **`-R`** - позволяет использовать директорию из окружения chroot.
---
* **`usermod`** - утилита для модификации пользователей. Группы может удалять только суперпользователь

  **`usermod [опции] имя-пользователя`**
  
  **Основные опции:**
  
  * **`-a`** -  Добавить пользователя в дополнительную группу(ы). Использовать только вместе с параметром -G;
  * **`-c`** - Новое значение поля комментария в файле пользовательских паролей. Обычно его изменяют с помощью программы chfn
  * **`-d`** -  Домашний каталог нового пользователя.\
  Если указан параметр -m, то содержимое текущего домашнего каталога будет перемещено в новый домашний каталог, который будет создан, если он ещё не существует.
  * **`-e`** - Дата, когда учётная запись пользователя будет заблокирована. Дата задаётся в формате ГГГГ-ММ-ДД
  * **`-f`** - Количество дней, которые должны пройти после устаревания пароля, чтобы учётная запись
           заблокировалась навсегда. \
           Если указано значение 0, то учётная запись блокируется сразу после устаревания пароля,
           а при значении -1 данная возможность не используется.\
           Для этого параметра требуется файл /etc/shadow. При отсутствии в /etc/shadow создаётся
           необходимая запись.
  * **`-g`** - Имя или числовой идентификатор новой первичной группы пользователя. Группа с таким
           именем должна существовать.\
           Все файлы в домашнем каталоге пользователя, принадлежавшие предыдущей первичной группе
           пользователя, будут принадлежать новой группе.\
           Группового владельца файлов вне домашнего каталога нужно изменить вручную.
  * **`-G`** - Список дополнительных групп, в которых числится пользователь.
  * **`-l`** - Имя пользователя будет изменено с ИМЯ на НОВОЕ_ИМЯ. Больше ничего не меняется. В частности, вероятно, должно быть изменено имя домашнего каталога и почтового ящика, чтобы отразить изменение имени пользователя.
  * **`-L`** - Заблокировать пароль пользователя. Это делается помещением символа «!» в начало шифрованного пароля, чтобы приводит к блокировке пароля.
  * **`-m`** -  Переместить содержимое домашнего каталога в новое место
  * **`-o`** - При использовании с параметром -u, этот параметр позволяет указывать не уникальный числовой идентификатор пользователя
  * **`-p`** - Шифрованное значение пароля, которое возвращает функция crypt(3)
  * **`-R`** - позволяет использовать директорию из окружения chroot
  * **`-s`** - Имя новой регистрационной оболочки пользователя. Если задать пустое значение, то будет использована регистрационная оболочка по умолчанию.
  * **`-u`** - Новый числовой идентификатор пользователя (UID)
  * **`-U`** - Разблокировать пароль пользователя. Это выполняется удалением символа «!» из начала шифрованного пароля.
---
* **`openssl`** - утилита для создания открытых и закрытых ключей.
---
* **`chage`** - утилита которая позволяет вам изменять информацию об истечении срока действия пароля

  **`chage [опции] имя-пользователя`**
  
  **Основные опции:**
  
  * **`-d`** - Установить число дней прошедших с 1 января 1970 года, когда была последняя смена пароля. Дата может быть также указана в виде ГГГГ-ММ-ДД
  * **`-I`** - установить число дней в неактивном состоянии пользователя, по истечении которых произойдет истечение пароля
  * **`-l`** - информация об истечении пароля пользователя
---
* **`chown`** - утилита которая позволяет вам изменять информацию об владельце файла

  **`$ chown пользователь опции /путь/к/файлу`**
  
  **Основные опции:**
  
  * **`-c`** - подробный вывод всех выполняемых изменений;
  * **`-f`** - минимум информации, скрыть сообщения об ошибках;
  * **`--dereference`** - изменять права для файла к которому ведет символическая ссылка вместо самой ссылки (поведение по умолчанию);
  * **`-h`** - изменять права символических ссылок и не трогать файлы, к которым они ведут;
  * **`--from`** - изменять пользователя только для тех файлов, владельцем которых является указанный пользователь и группа;
  * **`-R`** - рекурсивная обработка всех подкаталогов;
  * **`-H`** - если передана символическая ссылка на директорию - перейти по ней;
  * **`-L`** - переходить по всем символическим ссылкам на директории;
  * **`-P`** - не переходить по символическим ссылкам на директории (по умолчанию).
---
* **`chmod`** - утилита полномочий и превелегий

	**`$ chmod опции права /путь/к/файлу`**
	
	**Права:**
	
	* **`0`** - никаких прав;
	* **`1`** - только выполнение;
	* **`2`** - только запись;
	* **`3`** - выполнение и запись;
	* **`4`** - только чтение;
	* **`5`** - чтение и выполнение;
	* **`6`** - чтение и запись;
	* **`7`** - чтение, запись и выполнение;
	
	**Основные опции:**
	
	* **`-c`** - выводить информацию обо всех изменениях;;
	* **`-f`** - не выводить сообщения об ошибках;
	* **`-v`** - выводить максимум информации;
	* **`--preserve-root`** - не выполнять рекурсивные операции для корня "/";
	* **`--reference`** - взять маску прав из указанного файла;	
	* **`-R`** - включить поддержку рекурсии;
	* **`--version`** - вывести версию утилиты
	